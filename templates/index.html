<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Routines - AI Workout Timer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Favicons, Theme Color -->
    <style>
        /* Index Page Specific Styles (Keep previous production styles) */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; margin: 0; padding: 20px; background-color: #f0f2f5; color: #1c1e21; line-height: 1.6; }
        .container { max-width: 700px; margin: 20px auto; background: #ffffff; padding: 25px 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        h1 { text-align: center; color: #1c1e21; font-size: 2em; margin-bottom: 1.2em; }
        h2 { text-align: center; color: #333; font-size: 1.5em; margin-top: 1.5em; margin-bottom: 1em; border-bottom: 1px solid #e0e0e0; padding-bottom: 0.5em; }
        ul { list-style: none; padding: 0; margin-bottom: 2em; }
        li { margin: 12px 0; padding: 15px; background: #f7f7f7; border: 1px solid #ddd; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .routine-link { font-weight: 600; color: #0d6efd; flex-grow: 1; word-break: break-word; overflow-wrap: break-word; margin-right: 15px; font-size: 1.1em; }
        .start-button { padding: 10px 18px; background-color: #198754; color: white; border: none; border-radius: 5px; text-decoration: none; cursor: pointer; white-space: nowrap; transition: background-color 0.15s ease-in-out, transform 0.1s ease; flex-shrink: 0; font-size: 1em; font-weight: 500; }
        .start-button:hover { background-color: #157347; }
        .start-button:active { transform: translateY(1px); }
        hr { margin: 40px 0; border: 0; border-top: 1px solid #ccc; }
        form { margin-top: 25px; text-align: center; }
        .form-input-group { margin-bottom: 20px; }
        .form-input-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }
        input[type="file"] { display: block; margin: 0 auto 15px auto; padding: 10px; border: 1px solid #ccc; border-radius: 4px; max-width: 100%; background-color: #fff; }
        input[type="submit"] { padding: 12px 30px; background-color: #0d6efd; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1.05rem; font-weight: 500; transition: background-color 0.15s ease-in-out, transform 0.1s ease; }
        input[type="submit"]:hover { background-color: #0b5ed7; }
        input[type="submit"]:active { transform: translateY(1px); }
        .no-routines { text-align: center; color: #555; margin-top: 25px; font-style: italic; }
        .options-group { display: flex; flex-direction: column; align-items: stretch; gap: 15px; margin-bottom: 25px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 6px; background-color: #f9f9f9; }
        .options-group > div { display: flex; flex-direction: column; align-items: center; }
        .options-group label { margin-bottom: 6px; font-weight: 500; font-size: 0.95em; color: #333; }
        .options-group input[type="number"] { width: 100px; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; text-align: center; font-size: 1em; -moz-appearance: textfield; }
        .options-group input[type="number"]::-webkit-outer-spin-button, .options-group input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        @media (min-width: 480px) { .options-group { flex-direction: row; justify-content: space-around; align-items: flex-end; } .options-group > div { flex-basis: auto; } }
    </style>
</head>
<body>
    <noscript>
        <p style="padding: 20px; text-align: center; font-size: 1.2em; color: red; background-color: #ffebee; border: 1px solid red;">
            This application requires JavaScript to function. Please enable JavaScript in your browser.
        </p>
    </noscript>

    <div class="container">
        <h1>AI Workout Timer</h1>

        <div class="options-group">
            <div>
                <label for="intro-duration">Intro Duration (sec):</label>
                <input type="number" id="intro-duration" name="intro_duration" value="60" min="0" step="1" aria-label="Introductory period duration in seconds">
            </div>
            <div>
                <label for="outro-duration">Outro Duration (sec):</label>
                <input type="number" id="outro-duration" name="outro_duration" value="30" min="0" step="1" aria-label="Concluding period duration in seconds">
            </div>
        </div>

        <h2>Select a Routine</h2>
        {% if routines %}
            <ul>
                {% for routine in routines %}
                <li>
                   <span class="routine-link" title="{{ routine.replace('.yaml','').replace('.yml','') }}">
                       {{ routine.replace('.yaml','').replace('.yml','').replace('_',' ').title() }}
                   </span>
                   <form action="{{ url_for('workout', filename=routine) }}" method="get" class="routine-start-form">
                       <input type="hidden" name="intro" value="" aria-hidden="true">
                       <input type="hidden" name="outro" value="" aria-hidden="true">
                       <!-- REMOVED autoplay hidden input -->
                       <button type="submit" class="start-button">Start Workout</button>
                   </form>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="no-routines">No routines found.<br>Upload a YAML file to get started!</p>
        {% endif %}

        <hr>

        <h2>Upload New Routine</h2>
        <form action="{{ url_for('upload_routine') }}" method="post" enctype="multipart/form-data" class="upload-form">
             <div class="form-input-group">
                 <label for="routine_file_input">Select Workout YAML File:</label>
                 <input type="file" id="routine_file_input" name="routine_file" accept=".yaml,.yml" required aria-describedby="fileHelp">
                 <small id="fileHelp" style="display: block; font-size: 0.8em; color: #666; margin-top: 5px;">Allowed formats: .yaml, .yml. Max size: 1MB.</small>
             </div>
             <input type="submit" value="Upload Routine">
        </form>
    </div>

    <script>
        // Updated Script to just set Intro/Outro, no autoplay logic needed here
        document.addEventListener('DOMContentLoaded', () => {
            const introDurationInput = document.getElementById('intro-duration');
            const outroDurationInput = document.getElementById('outro-duration');
            const routineStartForms = document.querySelectorAll('.routine-start-form');

            if (introDurationInput && outroDurationInput && routineStartForms.length > 0) {
                routineStartForms.forEach(form => {
                    form.addEventListener('submit', function() {
                        let introValue = parseInt(introDurationInput.value, 10);
                        let outroValue = parseInt(outroDurationInput.value, 10);

                        this.querySelector('input[name="intro"]').value = (isNaN(introValue) || introValue < 0) ? 0 : introValue;
                        this.querySelector('input[name="outro"]').value = (isNaN(outroValue) || outroValue < 0) ? 0 : outroValue;
                    });
                });
            }
        });
    </script>
</body>
</html>